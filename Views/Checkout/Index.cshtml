@model List<BoxBuildproj.Models.Cart>
@{
    ViewData["Title"] = "Checkout";
}

<h2>Checkout</h2>

<table class="table">
    <thead>
        <tr>
            <th>Product</th>
            <th>Price</th>
            <th>Qty</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.Product.ProductName</td>
                <td>@item.Product.Price.ToString("C")</td>
                <td>@item.Quantity</td>
                <td>@(item.Product.Price * item.Quantity).ToString("C")</td>
            </tr>
        }
    </tbody>
</table>

<h4>Total: ₹@(ViewBag.TotalAmount / 100)</h4>

<button id="rzp-button1" class="btn btn-success">Pay Now</button>

@section Scripts {
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        document.getElementById('rzp-button1').onclick = function (e) {
            fetch('/Checkout/CreateOrder', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ totalAmount: @ViewBag.TotalAmount })
            })
            .then(res => res.json())
            .then(data => {
                var options = {
                    "key": "rzp_test_hXLdzaZ9MkR9Wf", // Replace with your Razorpay test/live key
                    "amount": @ViewBag.TotalAmount,
                    "currency": "INR",
                    "name": "BoxBuild",
                    "description": "Purchase Products",
                    "order_id": data.orderId,
                    "handler": function (response) {
                        window.location.href = '/Checkout/PaymentSuccess?paymentId=' + response.razorpay_payment_id;
                    },
                    "prefill": {
                        "email": "@ViewBag.UserEmail"
                    },
                    "theme": {
                        "color": "#3399cc"
                    }
                };
                var rzp = new Razorpay(options);
                rzp.open();
                e.preventDefault();
            });
        }
    </script>
}
